<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:UltimateHoopers.ViewModels"
             x:Class="UltimateHoopers.Pages.CreateRunPage"
             Title="Create Run"
             NavigationPage.HasNavigationBar="False"
             BackgroundColor="{StaticResource PageBackgroundColor}">

    <ContentPage.BindingContext>
        <vm:CreateRunViewModel />
    </ContentPage.BindingContext>

    <Grid RowDefinitions="Auto,*,Auto"
          Padding="20">

        <!-- Header with Title -->
        <Grid Grid.Row="0" 
              ColumnDefinitions="*,Auto"
              Margin="0,10,0,20">

            <VerticalStackLayout Grid.Column="0">
                <Label Text="Create Run"
                       FontSize="28"
                       FontAttributes="Bold"
                       TextColor="{StaticResource PrimaryColor}" />

                <Label Text="Host a pickup game"
                       FontSize="16"
                       TextColor="{StaticResource SecondaryTextColor}" />
            </VerticalStackLayout>

            <!-- Back Button -->
            <Frame Grid.Column="1"
                   CornerRadius="25"
                   HeightRequest="50"
                   WidthRequest="50"
                   Padding="0"
                   BorderColor="{StaticResource BorderColor}"
                   BackgroundColor="{StaticResource CardBackgroundColor}"
                   HasShadow="True">

                <Label Text="←"
                       FontSize="24"
                       HorizontalOptions="Center"
                       VerticalOptions="Center"
                       TextColor="{StaticResource PrimaryTextColor}" />

                <Frame.GestureRecognizers>
                    <TapGestureRecognizer Tapped="OnBackClicked" />
                </Frame.GestureRecognizers>
            </Frame>
        </Grid>

        <!-- Content Area -->
        <ScrollView Grid.Row="1">
            <VerticalStackLayout Spacing="20">

                <!-- Run Details Form -->
                <Frame BorderColor="{StaticResource BorderColor}"
                       CornerRadius="10"
                       HasShadow="True"
                       Padding="20"
                       BackgroundColor="{StaticResource CardBackgroundColor}">

                    <VerticalStackLayout Spacing="15">
                        <Label Text="Run Details"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="{StaticResource PrimaryTextColor}" />

                        <!-- Court Selection -->
                        <Label Text="Select Court"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{StaticResource PrimaryTextColor}" />

                        <Grid ColumnDefinitions="*,Auto" ColumnSpacing="10">
                            <Entry Grid.Column="0"
                                   Placeholder="Search courts..."
                                   Text="{Binding CourtSearchText}" />

                            <Button Grid.Column="1"
                                    Text="Find"
                                    WidthRequest="60"
                                    HeightRequest="40"
                                    Padding="0"
                                    BackgroundColor="{StaticResource PrimaryColor}"
                                    TextColor="White"
                                    CornerRadius="8"
                                    Command="{Binding SearchCourtsCommand}" />
                        </Grid>

                        <!-- Court Picker -->
                        <Frame BorderColor="{StaticResource BorderColor}"
                               CornerRadius="8"
                               Padding="10"
                               HasShadow="False">
                            <Picker ItemsSource="{Binding Courts}"
                                    SelectedItem="{Binding SelectedCourt}"
                                    Title="Select a court"
                                    ItemDisplayBinding="{Binding Name}" />
                        </Frame>

                        <!-- Date and Time Selection -->
                        <Label Text="Date and Time"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{StaticResource PrimaryTextColor}"
                               Margin="0,10,0,0" />

                        <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                            <VerticalStackLayout Grid.Column="0" Spacing="5">
                                <Label Text="Date"
                                       FontSize="14" />
                                <DatePicker Date="{Binding RunDate}"
                                            MinimumDate="{Binding MinimumDate}"
                                            Format="D" />
                            </VerticalStackLayout>

                            <VerticalStackLayout Grid.Column="1" Spacing="5">
                                <Label Text="Time"
                                       FontSize="14" />
                                <TimePicker Time="{Binding RunTime}"
                                            Format="t" />
                            </VerticalStackLayout>
                        </Grid>

                        <!-- Game Setup Options -->
                        <Label Text="Game Setup"
                               FontSize="16"
                               FontAttributes="Bold"
                               TextColor="{StaticResource PrimaryTextColor}"
                               Margin="0,10,0,0" />

                        <Grid ColumnDefinitions="*,*" ColumnSpacing="15">
                            <!-- Skill Level -->
                            <VerticalStackLayout Grid.Column="0" Spacing="5">
                                <Label Text="Skill Level"
                                       FontSize="14" />
                                <Picker ItemsSource="{Binding SkillLevels}"
                                        SelectedItem="{Binding SelectedSkillLevel}" />
                            </VerticalStackLayout>

                            <!-- Game Type -->
                            <VerticalStackLayout Grid.Column="1" Spacing="5">
                                <Label Text="Game Type"
                                       FontSize="14" />
                                <Picker ItemsSource="{Binding GameTypes}"
                                        SelectedItem="{Binding SelectedGameType}" />
                            </VerticalStackLayout>
                        </Grid>

                        <!-- Player Limit -->
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Player Limit"
                                   FontSize="14" />
                            <Slider Value="{Binding PlayerLimit}"
                                    Minimum="4"
                                    Maximum="20"
                                    StepFrequency="2" />
                            <Label Text="{Binding PlayerLimit, StringFormat='{0} players'}"
                                   HorizontalOptions="Center" />
                        </VerticalStackLayout>

                        <!-- Cost Section -->
                        <Grid ColumnDefinitions="Auto,*" ColumnSpacing="15">
                            <CheckBox Grid.Column="0"
                                      IsChecked="{Binding HasCost}"
                                      VerticalOptions="Center" />

                            <VerticalStackLayout Grid.Column="1" Spacing="5">
                                <Label Text="Charge players a fee"
                                       VerticalOptions="Center" />

                                <StackLayout Orientation="Horizontal"
                                             IsVisible="{Binding HasCost}">
                                    <Label Text="$"
                                           VerticalOptions="Center" />
                                    <Entry Text="{Binding Cost}"
                                           Keyboard="Numeric"
                                           WidthRequest="80"
                                           HorizontalTextAlignment="End" />
                                    <Label Text="per player"
                                           VerticalOptions="Center"
                                           Margin="5,0,0,0" />
                                </StackLayout>
                            </VerticalStackLayout>
                        </Grid>

                        <!-- Description -->
                        <VerticalStackLayout Spacing="5">
                            <Label Text="Description"
                                   FontSize="14" />
                            <Editor Text="{Binding Description}"
                                    Placeholder="Add details about your run..."
                                    HeightRequest="100"
                                    AutoSize="TextChanges" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Frame>

                <!-- Privacy Settings -->
                <Frame BorderColor="{StaticResource BorderColor}"
                       CornerRadius="10"
                       HasShadow="True"
                       Padding="20"
                       BackgroundColor="{StaticResource CardBackgroundColor}">

                    <VerticalStackLayout Spacing="15">
                        <Label Text="Privacy Settings"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="{StaticResource PrimaryTextColor}" />

                        <!-- Public/Private Toggle -->
                        <VerticalStackLayout Spacing="10">
                            <Grid ColumnDefinitions="*,Auto">
                                <VerticalStackLayout>
                                    <Label Text="Public Run"
                                           FontSize="16"
                                           FontAttributes="Bold" />
                                    <Label Text="Anyone can find and join your run"
                                           FontSize="14"
                                           TextColor="{StaticResource SecondaryTextColor}" />
                                </VerticalStackLayout>

                                <Switch Grid.Column="1"
                                        IsToggled="{Binding IsPublic}"
                                        OnColor="{StaticResource PrimaryColor}" />
                            </Grid>

                            <!-- Private Run Options -->
                            <VerticalStackLayout IsVisible="{Binding IsPublic, Converter={StaticResource InvertBoolConverter}}"
                                                 Margin="0,10,0,0">
                                <Label Text="Invitation Method"
                                       FontSize="14"
                                       FontAttributes="Bold" />

                                <RadioButton Content="Invite players directly"
                                             IsChecked="{Binding UseDirectInvites}"
                                             GroupName="InviteMethod" />

                                <RadioButton Content="Create invite code"
                                             IsChecked="{Binding UseInviteCode}"
                                             GroupName="InviteMethod" />

                                <Entry Placeholder="Optional: set a password"
                                       Text="{Binding Password}"
                                       IsVisible="{Binding UseInviteCode}"
                                       Margin="30,5,0,0"
                                       IsPassword="True" />
                            </VerticalStackLayout>
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Frame>
            </VerticalStackLayout>
        </ScrollView>

        <!-- Create Button -->
        <Button Grid.Row="2"
                Text="Create Run"
                BackgroundColor="{StaticResource PrimaryColor}"
                TextColor="White"
                FontAttributes="Bold"
                CornerRadius="25"
                HeightRequest="50"
                Command="{Binding CreateRunCommand}"
                IsEnabled="{Binding CanCreate}" />
    </Grid>
</ContentPage>